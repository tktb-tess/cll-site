---
interface H4Content {
  readonly text: string;
  readonly url: string;
}

interface H3Content {
  readonly text: string;
  readonly url: string;
  readonly h4: H4Content[];
}

interface H2Content {
  readonly text: string;
  readonly url: string;
  readonly h3: H3Content[];
}

export type { H2Content, H3Content, H4Content };

interface Props {
  readonly contents: H2Content[];
  readonly isTitle?: boolean;
  readonly class?: string;
}

const { contents, class: className, isTitle = false } = Astro.props;
---

<ul class={className} data-is-title={isTitle}>
  {
    contents.map((content) => (
      <li>
        <p>
          <a href={content.url}>{content.text}</a>
        </p>
        {content.h3.length > 0 && (
          <ul>
            {content.h3.map((h3) => (
              <li>
                <p>
                  <a href={h3.url}>{h3.text}</a>
                </p>
                {h3.h4.length > 0 && (
                  <ul>
                    {h3.h4.map((h4) => (
                      <li>
                        <a href={h4.url}>{h4.text}</a>
                      </li>
                    ))}
                  </ul>
                )}
              </li>
            ))}
          </ul>
        )}
      </li>
    ))
  }
</ul>

<style lang="postcss">
  @reference '../styles/globals.css';
  @layer components {
    ul:not([data-is-title="true"]) {
      @apply list-none ps-0;
      a {
        @apply block no-underline;
      }
    }
  }
</style>

<script>
  const details = document.getElementById('toc-details') as HTMLDetailsElement;
  const summary = details.querySelector('summary')!;
  summary.addEventListener('click', (ev) => {
    ev.preventDefault();
    details.open = !details.open;
    summary.textContent = details.open ? 'hide' : 'show';
  });
</script>
