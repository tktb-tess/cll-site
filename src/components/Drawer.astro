---
import ListIcon from '../assets/ListIcon.svg';
import CloseIcon from '../assets/CloseIcon.svg';
import Sidemenu from './Sidemenu.astro';
interface Props {
  readonly url: string;
}
const { url } = Astro.props;
---

<button type='button' id='drawer-btn' title='Open sidemenu'>
  <ListIcon class='size-6 inline-block' />
</button>
<div id='drawer-backdrop'>
  <aside id='drawer'>
    <button id='drawer-close-btn' type='button' title='Close sidemenu'>
      <CloseIcon class='inline-block size-6' />
    </button>
    <Sidemenu currentUrl={url} />
  </aside>
</div>

<style lang="postcss">
  @reference '../styles/globals.css';
  @layer components {
    #drawer-backdrop {
      @apply fixed z-1000 invisible inset-0 w-dvw h-dvh bg-transparent
      transition-[background-color,visibility] ease-(--tf-ease-in) ;

      &[data-drawer-open] {
        @apply visible bg-black/40 ease-(--tf-ease-out);
      }
    }

    #drawer {
      @apply -translate-x-full h-full w-64
      cbg-side overflow-x-auto px-2 py-2 transition-transform duration-160
      ease-(--tf-ease-in);

      :where([data-drawer-open]) > & {
        @apply translate-x-0 ease-(--tf-ease-out);
      }
    }

    #drawer-close-btn {
      @apply block ms-auto p-2 transition-colors
      any-hover:cbg-sidemenu-bg any-hover:ctext-text-inv rounded-lg;
    }

    #drawer-btn {
      @apply block lg:hidden fixed z-150 top-0 end-8 h-(--s-header) px-1 w-auto ms-auto any-hover:cbg-sidemenu-bg any-hover:ctext-text-inv transition-colors;
    }

    :global(:where(html, body):has([data-drawer-open])) {
      @apply overflow-y-clip;
    }
  }
</style>

<script>
  const drawerBackdrop = document.getElementById(
    'drawer-backdrop',
  ) as HTMLDivElement;
  const drawerBtn = document.getElementById('drawer-btn') as HTMLButtonElement;
  const drawerCloseBtn = document.getElementById(
    'drawer-close-btn',
  ) as HTMLButtonElement;
  drawerBtn.addEventListener('click', () => {
    drawerBackdrop.dataset.drawerOpen = '';

    setTimeout(() => {
      drawerCloseBtn.focus();
    }, 10);
  });

  drawerBackdrop.addEventListener('click', (ev) => {
    if (ev.target !== ev.currentTarget) return;
    delete drawerBackdrop.dataset.drawerOpen;
  });

  drawerCloseBtn.addEventListener('click', () => {
    delete drawerBackdrop.dataset.drawerOpen;
  });
</script>
