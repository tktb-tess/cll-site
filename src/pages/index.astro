---
import type { MarkdownHeading } from 'astro';
import Layout from '../layouts/Layout.astro';
import { urls } from '../modules/titles';
import Toc, { type H2Content, type H3Content } from '../components/Toc.astro';
import JboLogo from '../assets/jbo_logo.svg';

interface MdProps {
  readonly frontmatter: {
    readonly title: string;
    readonly description?: string;
  };
  readonly url: string;
  readonly getHeadings: () => MarkdownHeading[];
}

const mds_ = Object.values(
  import.meta.glob<MdProps>('./*.md', { eager: true }),
);

mds_.sort((a, b) => {
  let aIndex = urls.findIndex((s) => s === a.url);
  let bIndex = urls.findIndex((s) => s === b.url);
  if (aIndex === -1) {
    aIndex = Infinity;
  }
  if (bIndex === -1) {
    bIndex = Infinity;
  }
  return aIndex - bIndex;
});

const mds = mds_.map(({ frontmatter, url, getHeadings }): H2Content => {
  const h3 = getHeadings()
    .filter(({ depth }) => depth === 2)
    .map(({ text, slug }): H3Content => {
      return {
        text,
        url: `${url}#${slug}`,
        h4: [],
      };
    });
  const text = frontmatter.title;
  return {
    text,
    url,
    h3,
  };
});
---

<Layout title='The Complete Lojban Language' url='/'>
  <JboLogo class='max-w-90 w-full mx-auto' />
  <Toc contents={mds} open />
</Layout>
