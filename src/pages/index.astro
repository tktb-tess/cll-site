---
import type { MarkdownHeading } from 'astro';
import Layout from '../layouts/Layout.astro';
import { urls } from '../modules/titles';
import Toc, { type H2Content } from '../components/Toc.astro';
interface MdProps {
  readonly frontmatter: {
    readonly title: string;
    readonly description?: string;
  };
  readonly url: string;
  readonly getHeadings: () => MarkdownHeading[];
}

const mds_: MdProps[] = Object.values(
  import.meta.glob('./*.md', { eager: true })
);

mds_.sort((a, b) => {
  let aIndex = urls.findIndex((s) => s === a.url);
  let bIndex = urls.findIndex((s) => s === b.url);
  if (aIndex === -1) {
    aIndex = Infinity;
  }
  if (bIndex === -1) {
    bIndex = Infinity;
  }
  return aIndex - bIndex;
});

const mds: H2Content[] = mds_.map(({ frontmatter, url, getHeadings }) => {
  const h3 = getHeadings()
    .filter(({ depth }) => depth === 2)
    .map(({ text, slug }) => {
      return {
        text,
        url: `${url}#${slug}`,
        h4: [],
      };
    });
  const text = frontmatter.title;
  return {
    text,
    url,
    h3,
  };
});
---

<Layout title='The Complete Lojban Language' url='/'>
  <Toc contents={mds} />
</Layout>
